# Session Log: 2025-12-08

**Duration**: ~3 hours  
**Focus**: HV Pulse Transformer Support, Silicon-Steel Core Database, Bug Fixes

---

## Objectives Completed

### 1. Silicon-Steel Core Research (Phase 1-3)
- Researched laminated silicon-steel E/I core manufacturers
- Created HF vs LF transformer comparison guide
- Built silicon-steel core database with 12 EI cores (EI-28 to EI-240)
- Created Python loader module with core search and loss calculation

### 2. Dropless Transformer Specifications
- Calculated complete specs from requirements:
  - Volt-second: 500 V·ms
  - Required Ae: 2.08 cm²
  - Recommended core: EI-192

### 3. Bug Fixes
- **Bac = Bmax/2 issue**: Created `calculate_Bac_from_waveform()` supporting multiple waveforms
- **MLT/At estimation**: Improved geometry-based formulas
- **Layer estimation**: Verified already fixed with geometry-based calculation

---

## Files Created

| File | Purpose |
|------|---------|
| `backend/data/silicon_steel_cores.json` | 12 EI cores database |
| `backend/integrations/silicon_steel.py` | Core loader + loss calc |
| `.agent/logs/steel_core_research.md` | Manufacturer research |
| `.agent/logs/dropless_specs.md` | Calculated specs |
| `.agent/logs/phase3_core_selection.md` | Core selection results |

## Files Modified

| File | Changes |
|------|---------|
| `calculations/losses.py` | Added `calculate_Bac_from_waveform()` |
| `calculations/validation.py` | Uses waveform-aware Bac |
| `calculations/cross_validation.py` | Uses waveform-aware Bac |
| `calculations/__init__.py` | Exports new function |
| `routers/transformer.py` | Improved MLT/At formulas |

---

## Lessons Learned

### 1. **No Open-Source Silicon-Steel Core Database Exists**
Unlike ferrite cores (OpenMagnetics has 10k+), there's no machine-readable database for laminated steel cores. All data is in PDF catalogs from manufacturers like Grau-Stanzwerk, Benaka, JFE Steel.

**Implication**: Custom database creation is required for LF transformer design support.

### 2. **Bac ≠ Bmax/2 for All Waveforms**
The hardcoded assumption `Bac = Bmax/2` is wrong for:
- Asymmetric square waves (duty cycle ≠ 50%)
- Forward converter pulse waveforms
- Full-bridge with DC bias

**Fix**: Waveform-dependent calculation considering duty cycle and topology.

### 3. **MLT Estimation Needs Ae, Not Just Ap**
Original formula `MLT = 4 × sqrt(sqrt(Ap)) + 1` was geometry-independent.

**Better formula**: `MLT ≈ 4 × sqrt(Ae) × 1.2` (perimeter of center leg + bobbin).

### 4. **E-Core Proportions are Standardized**
When estimating dimensions from Ae/Wa:
- Center leg: `sqrt(Ae)` (square stack assumption)
- Window height ≈ 1.5 × window width
- Total width = center_leg + 2 × window_width

### 5. **HV Pulse Transformer Requirements**
Dropless-style applications need:
- **kA-level primary current** → foil/cable windings
- **kV-level secondary** → reinforced insulation, 10mm+ creepage
- **Silicon-steel cores** → 1.2-1.5T Bmax (6× higher than ferrite)
- **Millisecond pulse widths** → large volt-second products

### 6. **OpenMagnetics Has No Silicon-Steel Materials**
The 10k+ cores in OpenMagnetics are all ferrite/powder materials. For 50-400Hz transformers, a separate database is needed.

---

## Test Results

```
test_api.py: All passed ✅
test_pulse_transformer.py: 7 passed, 1 skipped ✅
```

---

## Next Steps (from implementation plan)

1. **Integrate silicon-steel cores** into pulse transformer router for HV power pulse
2. **Add export buttons** (MAS, FEMM, JSON) to UI
3. **Implement Litz wire** recommendation for HF designs
4. **Increase test coverage** to 80%

---

## Key Calculations Reference

### Volt-Second
```
V·t = V × t_pulse
```

### Core Area from Faraday's Law
```
Ae = V·t / (N × ΔB)
```

### Bac from Waveform
```python
# Symmetric square wave
Bac = Bmax

# Asymmetric (duty cycle D)
Bac = Bmax × 2 × min(D, 1-D) / 2

# Unipolar pulse
Bac = Bmax × D
```

### MLT Estimation
```python
MLT_cm ≈ 4 × sqrt(Ae_cm2) × 1.2
```

### Core Loss (Steinmetz)
```
Pv = k × f^α × Bac^β [mW/cm³]
```
Silicon steel at 125Hz: ~2-3 W/kg at 1.5T
